{% extends "base.html" %}
{% block content %}
<section class="grid gap-6 lg:grid-cols-2">
  <div class="space-y-4">
    <h2 class="text-2xl font-semibold">Start a fresh run (Legacy)</h2>
    {% if error %}
    <div class="bg-red-500/10 border border-red-500 text-red-200 rounded px-4 py-3">{{ error }}</div>
    {% endif %}
    <div class="ninebox u-box">
      <div class="nf tl"></div>
      <div class="nf t"></div>
      <div class="nf tr"></div>
      <div class="nf l"></div>
      <div class="nf c"></div>
      <div class="nf r"></div>
      <div class="nf bl"></div>
      <div class="nf b"></div>
      <div class="nf br"></div>
      <div class="nine-content">
        <form method="post" action="{{ url_for('start_game') }}" class="space-y-6 u-box-content">
          <div>
            <label class="block text-sm font-medium text-slate-300">Scenario</label>
            <div class="mt-2 grid grid-cols-2 gap-3 text-sm">
              {% set current = previous.get('scenario') if previous else 'apocalypse' %}
              {% for value, label in [('apocalypse', 'Apocalypse'), ('dark_fantasy', 'Dark Fantasy'), ('haunted_house', 'Haunted House'), ('custom', 'Custom World')] %}
              <label class="scenario-card">
                <input type="radio" name="scenario" value="{{ value }}" {% if current==value %}checked{% endif %} />
                <span class="scenario-face">{{ label }}</span>
              </label>
              {% endfor %}
            </div>
          </div>
          <div class="grid gap-4 sm:grid-cols-2">
            <div>
              <label class="block text-sm">Campaign label</label>
              <div class="mt-1 u-input-shell">
                <input type="text" name="custom_label" value="{{ previous.get('custom_label') if previous else '' }}" placeholder="Sky Citadel" class="u-input" />
              </div>
            </div>
            <div>
              <label class="block text-sm">Gemma / Ollama model</label>
              <div class="mt-1 u-input-shell">
                <input type="text" name="model" value="{{ previous.get('model') if previous else 'gemma3:12b' }}" class="u-input" />
              </div>
            </div>
          </div>
          <div>
            <label class="block text-sm">Ollama host (optional)</label>
            <div class="mt-1 u-input-shell">
              <input type="text" name="ollama_host" value="{{ previous.get('ollama_host') if previous else '' }}" placeholder="http://127.0.0.1:11434" class="u-input" />
            </div>
          </div>
          <div class="grid gap-4 sm:grid-cols-2">
            <div>
              <label class="block text-sm">Player name</label>
              <div class="mt-1 u-input-shell">
                <input type="text" name="player_name" value="{{ previous.get('player_name') if previous else '' }}" class="u-input" />
              </div>
            </div>
            <div>
              <label class="block text-sm">Age</label>
              <div class="mt-1 u-input-shell">
                <input type="number" name="player_age" value="{{ previous.get('player_age') if previous else '' }}" class="u-input" />
              </div>
            </div>
          </div>
          <div class="grid gap-4 sm:grid-cols-3">
            <div>
              <label class="block text-sm">Pronouns / Sex</label>
              <div class="mt-1 u-input-shell">
                <input type="text" name="player_sex" value="{{ previous.get('player_sex') if previous else '' }}" class="u-input" />
              </div>
            </div>
            <div>
              <label class="block text-sm">Hair</label>
              <div class="mt-1 u-input-shell">
                <input type="text" name="player_hair" value="{{ previous.get('player_hair') if previous else '' }}" class="u-input" />
              </div>
            </div>
            <div>
              <label class="block text-sm">Clothing</label>
              <div class="mt-1 u-input-shell">
                <input type="text" name="player_clothing" value="{{ previous.get('player_clothing') if previous else '' }}" class="u-input" />
              </div>
            </div>
          </div>
          <div>
            <label class="block text-sm">Appearance details</label>
            <div class="mt-1 u-input-shell">
              <input type="text" name="player_appearance" value="{{ previous.get('player_appearance') if previous else '' }}" class="u-input" />
            </div>
          </div>
          <div>
            <label class="block text-sm">World bible / notes</label>
            <div class="mt-1 u-input-shell">
              <textarea name="world_notes" rows="4" class="u-input">{{ previous.get('world_notes') if previous else '' }}</textarea>
            </div>
          </div>
          <button type="submit" class="u-button w-full">Launch campaign</button>
        </form>
      </div>
    </div>
  </div>
  <div class="space-y-6">
    <div class="ninebox u-box">
      <div class="nf tl"></div>
      <div class="nf t"></div>
      <div class="nf tr"></div>
      <div class="nf l"></div>
      <div class="nf c"></div>
      <div class="nf r"></div>
      <div class="nf bl"></div>
      <div class="nf b"></div>
      <div class="nf br"></div>
      <div class="nine-content u-box-content">
        <h3 class="text-xl font-semibold">About this build</h3>
        <ul class="mt-4 space-y-3 text-sm text-slate-300">
          <li>• Flask + HTMX front-end rendered in a PyWebview shell.</li>
          <li>• Tailwind CSS + Daisy-esque cards for quick theming.</li>
          <li>• Shared engine + Gemma prompts from the core RP-GPT stack.</li>
          <li>• Desktop now, web deployment later with the same code.</li>
        </ul>
      </div>
    </div>
    {% if has_active %}
    <div class="ninebox u-box">
      <div class="nf tl"></div>
      <div class="nf t"></div>
      <div class="nf tr"></div>
      <div class="nf l"></div>
      <div class="nf c"></div>
      <div class="nf r"></div>
      <div class="nf bl"></div>
      <div class="nf b"></div>
      <div class="nf br"></div>
      <div class="nine-content u-box-content">
        <p class="text-slate-200 mb-3">You have an active session. Jump back in?</p>
        <a href="{{ url_for('play') }}" class="u-button w-full sm:w-auto">Resume adventure →</a>
      </div>
    </div>
    {% endif %}
  </div>
</section>
{% endblock %}
